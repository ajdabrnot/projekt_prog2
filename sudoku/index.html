<!doctype html>
<html>

<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
  <title>SUDOKU NORO</title>
  <link rel="stylesheet" href="izgled.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>
  <div id="app"></div>
  
  <!-- Globalna PDF funkcija - BREZ type="module" -->
  <script>
    window.shraniSudokuKotPDF = function() {
      console.log("Shranjujem PDF...");
      
      setTimeout(() => {
        try {
          const sudokuTabele = document.querySelectorAll(".osnovna_tabela");
          
          if (sudokuTabele.length < 2) {
            console.error("Ne najdem obeh sudoku tabel");
            return;
          }
          
          const sudokuLevo = sudokuTabele[0]; // input mre≈æa
          const sudokuDesno = sudokuTabele[1]; // re≈°ena mre≈æa

          // === PRVA STRAN - NALOGA ===
          const firstPage = document.createElement("div");
          firstPage.style.fontFamily = "'Helvetica Neue', Arial, sans-serif";
          firstPage.style.padding = "40px";
          firstPage.style.textAlign = "center";
          firstPage.style.minHeight = "100vh";
          firstPage.style.display = "flex";
          firstPage.style.flexDirection = "column";
          firstPage.style.justifyContent = "center";
          firstPage.style.alignItems = "center";
          firstPage.style.backgroundColor = "#fafafa";

          // Glavni naslov
          const glavniNaslov = document.createElement("h1");
          glavniNaslov.textContent = "üß© SUDOKU IZZIV";
          glavniNaslov.style.fontSize = "36px";
          glavniNaslov.style.color = "#2c3e50";
          glavniNaslov.style.marginBottom = "20px";
          glavniNaslov.style.fontWeight = "bold";
          glavniNaslov.style.textShadow = "2px 2px 4px rgba(0,0,0,0.1)";
          firstPage.appendChild(glavniNaslov);

          // Podnaslov
          const podnaslov = document.createElement("h2");
          podnaslov.textContent = "NALOGA";
          podnaslov.style.fontSize = "24px";
          podnaslov.style.color = "#34495e";
          podnaslov.style.marginBottom = "30px";
          podnaslov.style.letterSpacing = "2px";
          firstPage.appendChild(podnaslov);

          // Naloga sudoku
          const nalamaContainer = document.createElement("div");
          nalamaContainer.style.backgroundColor = "white";
          nalamaContainer.style.padding = "30px";
          nalamaContainer.style.borderRadius = "15px";
          nalamaContainer.style.boxShadow = "0 10px 30px rgba(0,0,0,0.15)";
          nalamaContainer.style.border = "3px solid #3498db";
          
          const levoKlon = sudokuLevo.cloneNode(true);
          nalamaContainer.appendChild(levoKlon);
          firstPage.appendChild(nalamaContainer);

          // // Navodila
          // const navodila = document.createElement("div");
          // navodila.style.marginTop = "30px";
          // navodila.style.padding = "20px";
          // navodila.style.backgroundColor = "#ecf0f1";
          // navodila.style.borderRadius = "10px";
          // navodila.style.maxWidth = "500px";
          
          // const navodilaText = document.createElement("p");
          // navodilaText.innerHTML = "<strong>Navodila:</strong><br>Izpolnite mre≈æo tako, da vsaka vrstica, stolpec in 3√ó3 kvadrat vsebuje ≈°tevila od 1 do 9, vsako natanko enkrat.";
          // navodilaText.style.fontSize = "14px";
          // navodilaText.style.lineHeight = "1.5";
          // navodilaText.style.color = "#2c3e50";
          // navodila.appendChild(navodilaText);
          // firstPage.appendChild(navodila);

          // === DRUGA STRAN - RE≈†ITEV ===
          const secondPage = document.createElement("div");
          secondPage.style.fontFamily = "'Helvetica Neue', Arial, sans-serif";
          secondPage.style.padding = "40px";
          secondPage.style.textAlign = "center";
          secondPage.style.minHeight = "100vh";
          secondPage.style.display = "flex";
          secondPage.style.flexDirection = "column";
          secondPage.style.justifyContent = "center";
          secondPage.style.alignItems = "center";
          secondPage.style.backgroundColor = "#f8f9fa";
          secondPage.style.pageBreakBefore = "always"; // NOVA STRAN!

          // Naslov re≈°itve
          const resitevNaslov = document.createElement("h1");
          resitevNaslov.textContent = "‚úÖ RE≈†ITEV";
          resitevNaslov.style.fontSize = "36px";
          resitevNaslov.style.color = "#27ae60";
          resitevNaslov.style.marginBottom = "40px";
          resitevNaslov.style.fontWeight = "bold";
          resitevNaslov.style.textShadow = "2px 2px 4px rgba(0,0,0,0.1)";
          secondPage.appendChild(resitevNaslov);

          // Re≈°itev sudoku
          const resitevContainer = document.createElement("div");
          resitevContainer.style.backgroundColor = "white";
          resitevContainer.style.padding = "30px";
          resitevContainer.style.borderRadius = "15px";
          resitevContainer.style.boxShadow = "0 10px 30px rgba(0,0,0,0.15)";
          resitevContainer.style.border = "3px solid #27ae60";
          
          const desnoKlon = sudokuDesno.cloneNode(true);
          resitevContainer.appendChild(desnoKlon);
          secondPage.appendChild(resitevContainer);

          // // ƒåestitke
          // const cestitke = document.createElement("div");
          // cestitke.style.marginTop = "30px";
          // cestitke.style.padding = "20px";
          // cestitke.style.backgroundColor = "#d5f4e6";
          // cestitke.style.borderRadius = "10px";
          // cestitke.style.maxWidth = "400px";
          
          // const cestitkeText = document.createElement("p");
          // cestitkeText.innerHTML = "üéâ <strong>Odliƒçno delo!</strong><br>Uspe≈°no ste re≈°ili sudoku!";
          // cestitkeText.style.fontSize = "16px";
          // cestitkeText.style.lineHeight = "1.5";
          // cestitkeText.style.color = "#27ae60";
          // cestitke.appendChild(cestitkeText);
          // secondPage.appendChild(cestitke);

          // Kombinacija obeh strani
          const pdfContent = document.createElement("div");
          pdfContent.appendChild(firstPage);
          pdfContent.appendChild(secondPage);

          // Pobri≈°i vse gumbe in inpute
          const vsiGumbi = pdfContent.querySelectorAll('input[type="button"], button');
          vsiGumbi.forEach(gumb => gumb.remove());
          
          // Styling za tabele
          const tabele = pdfContent.querySelectorAll('table');
          tabele.forEach(tabela => {
            tabela.style.border = '3px solid #2c3e50';
            tabela.style.borderCollapse = 'collapse';
            tabela.style.margin = '0 auto';
            tabela.style.borderRadius = '8px';
            tabela.style.overflow = 'hidden';
          });
          
          const celice = pdfContent.querySelectorAll('td, th');
          celice.forEach((celica, index) => {
            celica.style.border = '1px solid #7f8c8d';
            celica.style.padding = '12px';
            celica.style.textAlign = 'center';
            celica.style.fontSize = '16px';
            celica.style.fontWeight = 'bold';
            celica.style.color = '#2c3e50';
            
            // Razliƒçne barve za razliƒçne 3x3 bloke
            const row = Math.floor(index / 9);
            const col = index % 9;
            const blockRow = Math.floor(row / 3);
            const blockCol = Math.floor(col / 3);
            const blockIndex = blockRow * 3 + blockCol;
            
            if (blockIndex % 2 === 0) {
              celica.style.backgroundColor = '#ecf0f1';
            } else {
              celica.style.backgroundColor = '#ffffff';
            }
          });

          // Generiraj PDF
          const opt = {
            margin: 10,
            filename: 'sudoku_izziv.pdf',
            image: { type: 'jpeg', quality: 0.95 },
            html2canvas: { 
              scale: 1.5,
              useCORS: true,
              allowTaint: true,
              backgroundColor: null
            },
            jsPDF: { 
              unit: 'mm', 
              format: 'a4', 
              orientation: 'portrait' // pokonƒçno za lep≈°i izgled
            }
          };

          html2pdf().set(opt).from(pdfContent).save().then(() => {
            console.log("üéâ Lep PDF uspe≈°no shranjen!");
          }).catch((error) => {
            console.error("Napaka pri shranjevanju PDF:", error);
          });

        } catch (error) {
          console.error("Napaka pri kreiranju PDF:", error);
        }
      }, 100);
    };
  </script>

  <!-- WASM inicializacija - mora biti ZADNJA -->
  <script type="module">
    import init from './pkg/sudoku.js';
    await init().catch(console.error);
  </script>

</body>

</html>