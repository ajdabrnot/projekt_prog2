<!doctype html>
<html>

<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
  <title>SUDOKU NORO</title>
  <link rel="stylesheet" href="izgled.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>
  <div id="app"></div>
  <script>
    window.shraniSudokuKotPDF = function() {
      console.log("Shranjujem PDF...");
      
      setTimeout(() => {
        try {
          const sudokuTabele = document.querySelectorAll(".osnovna_tabela");
          
          if (sudokuTabele.length < 2) {
            console.error("Prišlo je do napake, poskusi še enkrat.");
            return;
          }
          
          const sudokuLevo = sudokuTabele[0]; // input mreža
          const sudokuDesno = sudokuTabele[1]; // rešena mreža

          // Funkcija za styling sudoku tabele
          function styleSudokuTable(tabela, containerColor) {
            // Osnovni styling tabele
            tabela.style.borderCollapse = 'collapse';
            tabela.style.margin = '0 auto';
            tabela.style.backgroundColor = 'white';
            tabela.style.border = `3px solid ${containerColor}`;
            
            // Najdi vse vrstice
            const vrstice = tabela.querySelectorAll('tr');
            
            vrstice.forEach((vrstica, rowIndex) => {
              const celice = vrstica.querySelectorAll('td, th');
              
              celice.forEach((celica, colIndex) => {
                // Osnovni styling celice
                celica.style.width = '40px';
                celica.style.height = '40px';
                celica.style.textAlign = 'center';
                celica.style.fontSize = '18px';
                celica.style.fontWeight = 'bold';
                celica.style.color = '#2c3e50';
                celica.style.backgroundColor = 'white';
                celica.style.padding = '8px';
                celica.style.boxSizing = 'border-box';
                
                // Osnovne tanke črte
                celica.style.border = '1px solid #bdc3c7';
                
                // Debele črte za 3x3 bloke
                // Desne debele črte (po 3. in 6. stolpcu)
                if (colIndex === 2 || colIndex === 5) {
                  celica.style.borderRight = '3px solid #34495e';
                }
                
                // Spodnje debele črte (po 3. in 6. vrstici)
                if (rowIndex === 2 || rowIndex === 5) {
                  celica.style.borderBottom = '3px solid #34495e';
                }
                
                // Če je celica input element, nastavi styling
                const input = celica.querySelector('input');
                if (input) {
                  input.style.border = 'none';
                  input.style.outline = 'none';
                  input.style.backgroundColor = 'transparent';
                  input.style.textAlign = 'center';
                  input.style.fontSize = '18px';
                  input.style.fontWeight = 'bold';
                  input.style.color = '#2c3e50';
                  input.style.width = '100%';
                  input.style.height = '100%';
                }
              });
            });
          }

          // Naloga 
          const firstPage = document.createElement("div");
          firstPage.style.fontFamily = "'Helvetica Neue', Arial, sans-serif";
          firstPage.style.padding = "30px";
          firstPage.style.textAlign = "center";
          firstPage.style.height = "100vh";
          firstPage.style.display = "flex";
          firstPage.style.flexDirection = "column";
          firstPage.style.justifyContent = "center";
          firstPage.style.alignItems = "center";
          firstPage.style.backgroundColor = "#ffffff";
          firstPage.style.boxSizing = "border-box";

          // Glavni naslov
          const glavniNaslov = document.createElement("h1");
          glavniNaslov.textContent = "🧩 SUDOKU IZZIV";
          glavniNaslov.style.fontSize = "28px";
          glavniNaslov.style.color = "#2c3e50";
          glavniNaslov.style.marginBottom = "15px";
          glavniNaslov.style.fontWeight = "bold";
          glavniNaslov.style.margin = "0 0 15px 0";
          firstPage.appendChild(glavniNaslov);

          // Podnaslov
          const podnaslov = document.createElement("h2");
          podnaslov.textContent = "NALOGA";
          podnaslov.style.fontSize = "20px";
          podnaslov.style.color = "#34495e";
          podnaslov.style.marginBottom = "25px";
          podnaslov.style.letterSpacing = "2px";
          podnaslov.style.margin = "0 0 25px 0";
          firstPage.appendChild(podnaslov);

          // Naloga sudoku 
          const nalogeContainer = document.createElement("div");
          nalogeContainer.style.backgroundColor = "white";
          nalogeContainer.style.padding = "20px";
          nalogeContainer.style.borderRadius = "10px";
          nalogeContainer.style.boxShadow = "0 5px 15px rgba(0,0,0,0.1)";
          nalogeContainer.style.border = "2px solid #3498db";
          nalogeContainer.style.display = "inline-block";
          
          const levoKlon = sudokuLevo.cloneNode(true);
          
          // Pobriši gumbe 
          const gumbiLevo = levoKlon.querySelectorAll('input[type="button"], button');
          gumbiLevo.forEach(gumb => gumb.remove());
          
          styleSudokuTable(levoKlon, '#3498db');
          nalogeContainer.appendChild(levoKlon);
          firstPage.appendChild(nalogeContainer);

          // Rešitev 
          const secondPage = document.createElement("div");
          secondPage.style.fontFamily = "'Helvetica Neue', Arial, sans-serif";
          secondPage.style.padding = "30px";
          secondPage.style.textAlign = "center";
          secondPage.style.height = "100vh";
          secondPage.style.display = "flex";
          secondPage.style.flexDirection = "column";
          secondPage.style.justifyContent = "center";
          secondPage.style.alignItems = "center";
          secondPage.style.backgroundColor = "#ffffff";
          secondPage.style.pageBreakBefore = "always";
          secondPage.style.boxSizing = "border-box";

          // Naslov rešitve
          const resitevNaslov = document.createElement("h1");
          resitevNaslov.textContent = "✅ REŠITEV";
          resitevNaslov.style.fontSize = "28px";
          resitevNaslov.style.color = "#27ae60";
          resitevNaslov.style.marginBottom = "25px";
          resitevNaslov.style.fontWeight = "bold";
          resitevNaslov.style.margin = "0 0 25px 0";
          secondPage.appendChild(resitevNaslov);

          // Rešitev sudokuja 
          const resitevContainer = document.createElement("div");
          resitevContainer.style.backgroundColor = "white";
          resitevContainer.style.padding = "20px";
          resitevContainer.style.borderRadius = "10px";
          resitevContainer.style.boxShadow = "0 5px 15px rgba(0,0,0,0.1)";
          resitevContainer.style.border = "2px solid #27ae60";
          resitevContainer.style.display = "inline-block";
          
          const desnoKlon = sudokuDesno.cloneNode(true);
          
          // Pobriši gumbe 
          const gumbiDesno = desnoKlon.querySelectorAll('input[type="button"], button');
          gumbiDesno.forEach(gumb => gumb.remove());
          
          styleSudokuTable(desnoKlon, '#27ae60');
          resitevContainer.appendChild(desnoKlon);
          secondPage.appendChild(resitevContainer);

          // Kombinacija obeh strani
          const pdfContent = document.createElement("div");
          pdfContent.appendChild(firstPage);
          pdfContent.appendChild(secondPage);

          // debugging
          console.log("Prva stran HTML:", firstPage.outerHTML.substring(0, 200));
          console.log("Druga stran HTML:", secondPage.outerHTML.substring(0, 200));
          console.log("Kombiniran PDF content:", pdfContent.children.length, "strani");

          // PDF opcije z boljšimi nastavitvami
          const opt = {
            margin: 10,
            filename: 'sudoku_izziv.pdf',
            image: { 
              type: 'jpeg', 
              quality: 0.95 
            },
            html2canvas: { 
              scale: 1.5,
              useCORS: true,
              allowTaint: true,
              backgroundColor: '#ffffff'
            },
            jsPDF: { 
              unit: 'mm', 
              format: 'a4', 
              orientation: 'portrait'
            }
          };

          // Generiraj PDF
          html2pdf().set(opt).from(pdfContent).save().then(() => {
            console.log("PDF uspešno shranjen!");
          }).catch((error) => {
            console.error("Napaka pri shranjevanju PDF:", error);
          });

        } catch (error) {
          console.error("Napaka pri kreiranju PDF:", error);
        }
      }, 100);
    };
  </script>

  <script type="module">
    import init from './pkg/sudoku.js';
    await init().catch(console.error);
  </script>

</body>

</html>